%% Rebar3 configuration for elmdb-rs project

{erl_opts, [debug_info]}.

{deps, []}.

{plugins, [
    {rebar3_cargo, "0.1.1"}
]}.

{provider_hooks, [
    {pre, [
        {compile, {cargo, build}}
    ]},
    {post, [
        {clean, {cargo, clean}}
    ]}
]}.

{cargo_opts, [
    {src_dir, "native/elmdb_nif"},
    {cargo_args, ["--release"]}
]}.

{post_hooks, [
    {"(linux|darwin|solaris)", compile, "cp native/elmdb_nif/target/release/libelm* priv/"},
    {"win32", compile, "copy native\\elmdb_nif\\target\\release\\elm*.dll priv\\"},
    { compile, "cp priv/crates/elmdb_nif/elmdb_nif.so priv/elmdb_nif.so 2>/dev/null || true" }
]}.

{pre_hooks, [
    {compile, "mkdir -p priv/"}
]}.

{shell, [
    {config, "config/sys.config"},
    {apps, [elmdb]}
]}.
