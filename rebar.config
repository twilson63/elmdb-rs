%% Rebar3 configuration for elmdb-rs project

%% Erlang compiler options
{erl_opts, [debug_info]}.

%% Dependencies
{deps, []}.

%% Plugins
{plugins, [rebar3_rustler]}.


%% Cargo configuration
{cargo_opts, [
    {src_dir, "native/elmdb_nif"},
    {cargo_args, ["--release"]}
]}.

%% Build hooks
{provider_hooks, [
    {pre, [
        {compile, {cargo, build}}
    ]},
    {post, [
        {clean, {cargo, clean}}
    ]}
]}.

%% Test configuration
{eunit_opts, [
    verbose,
    {report, {eunit_surefire, [{dir, "_build/test/logs"}]}}
]}.

{eunit_compile_opts, [
    {src_dirs, ["src", "test"]}
]}.

%% Shell configuration
{shell, [
    {config, "config/sys.config"},
    {apps, [elmdb]}
]}.

%% Coverage analysis
{cover_enabled, false}.
{cover_opts, [verbose]}.

%% Profiles for different build configurations
{profiles, [
    {prod, [
        {cargo_opts, [
            {src_dir, "native/elmdb_nif"},
            {cargo_args, ["--release", "--", "--emit=asm"]}
        ]},
        {erl_opts, [no_debug_info]}
    ]},
    {test, [
        {deps, []},
        {erl_opts, [debug_info, export_all]}
    ]}
]}.