%% Rebar3 configuration for elmdb-rs project

{erl_opts, [debug_info]}.

{eunit_opts, [
    verbose,
    {report, {eunit_surefire, [{dir, "_build/test/logs"}]}}
]}.

{eunit_compile_opts, [
    {src_dirs, ["src", "test"]}
]}.

{deps, []}.

{plugins, [
    {rebar3_cargo, "0.1.1"}
]}.

{provider_hooks, [
    {pre, [
        {compile, {cargo, build}}
    ]},
    {post, [
        {clean, {cargo, clean}}
    ]}
]}.

{cargo_opts, [
    {src_dir, "native/elmdb_nif"},
    {cargo_args, ["--release"]}
]}.

{post_hooks, [
    {"(linux|darwin|solaris)", compile, "find native/elmdb_nif/target -name 'libelmdb_nif.*' -not -path '*/deps/*' | head -1 | xargs -I {} cp {} priv/ && cd priv && ln -sf libelmdb_nif.dylib libelmdb_nif.so 2>/dev/null || true"},
    {"win32", compile, "copy native\\elmdb_nif\\target\\debug\\elmdb_nif.dll priv\\"}
]}.

{pre_hooks, [
    {compile, "mkdir -p priv/"}
]}.

{shell, [
    {config, "config/sys.config"},
    {apps, [elmdb]}
]}.